<ion-header>
  <ion-navbar>
    <ion-title>Conversations</ion-title>
  </ion-navbar>
</ion-header>


<ion-content>

  <!-- Swipe to Refresh -->
  <ion-refresher (ionRefresh)="doRefresh($event)" [enabled]="conversations.conversationList">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- When content isn't available' -->
  <div class="page-loading" *ngIf="conversations.isLoading && !conversations.refresherLoading">
    <img src='assets/brand/loader.gif'>
  </div>

  <!-- When content available -->
  <div *ngIf="!conversations.isLoading || conversations.refresherLoading">

    <!-- Unhandled Conversations -->
    <ion-list class="unhandled" *ngIf="conversations.unhandledConversations && conversations.unhandledConversations.length > 0">
      <ion-list-header>
        Unhandled Conversations
      </ion-list-header>

      <button ion-item detail-none 
        *ngFor="let conversationItem of conversations.unhandledConversations;trackBy:conversationItem?.comment_by_username">
        
        <ion-avatar item-left>
          <img src="{{ conversationItem.comment_by_photo }}" onError="this.src='assets/user.png';">
        </ion-avatar>

        <h3 class='elipse'>{{ conversationItem.comment_by_fullname }}</h3>
        <p>@{{ conversationItem.comment_by_username }}</p>
        <p>{{ conversationItem.comment_text }}</p>

        <ion-note item-right>{{ conversationItem.comment_datetime }}</ion-note>
        <ion-badge color="danger">{{ conversationItem.unhandledCount }}</ion-badge>
      </button>

    </ion-list>

    <!-- Conversations -->
    <ion-list *ngIf="conversations.handledConversations && conversations.handledConversations.length > 0">
      <ion-list-header>
        Conversations
      </ion-list-header>

      <button ion-item detail-none 
        *ngFor="let conversationItem of conversations.handledConversations;trackBy:conversationItem?.comment_by_username">
        <ion-avatar item-left>
          <img src="{{ conversationItem.comment_by_photo }}" onError="this.src='assets/user.png';">
        </ion-avatar>

        <h3 class='elipse'>{{ conversationItem.comment_by_fullname }}</h3>
        <p>@{{ conversationItem.comment_by_username }}</p>
        <p>{{ conversationItem.comment_text }}</p>

        <ion-note item-right>{{ conversationItem.comment_datetime }}</ion-note>
      </button>

    </ion-list>

  </div>

</ion-content>